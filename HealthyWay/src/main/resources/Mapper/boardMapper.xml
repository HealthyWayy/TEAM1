<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper

  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.team1.health.dao.BoardDAO">
	<!-- PT페이지 -->
	<insert id="ptBoardInsert">
		insert into board(user_id, title, content, type_num) 
		values(#{user_id}, #{title}, #{content}, 2)
	</insert>
	
	<insert id="ptGroupInsert">
		insert into PT_group(board_num, start_date, end_date, max_user, keyword) 
		values((select board_num from board where title=#{title} and user_id=#{user_id} and content=#{content}), #{start_date}, #{end_date}, #{max_user}, #{keyword})
	</insert>
	
	<select id="ptList" resultType="BoardVO">
		select b.board_num, user_id, title, hit, date_format(write_date, '%Y-%m-%d') writedate, state, start_date, end_date, max_user, keyword 
		from board b inner join PT_group p on b.board_num=p.board_num
		where type_num=2
		<if test="searchWord != null">
			and (title like '%${searchWord}%' or keyword like '%${searchWord}%' or content like '%${searchWord}%' or user_id like '%${searchWord}%')
		</if>
		order by b.board_num desc
	</select>
	<select id="ptBoardSelect" resultType="BoardVO">
		select b.user_id, b.board_num, title, keyword, state, content, start_date, end_date
		from board b 
		inner join PT_group p on b.board_num=p.board_num
		where b.board_num=#{param1}
	</select>
	<update id="hitCount">
		update board set hit = hit+1
		where board_num=${param1}
	</update>
	<!--  게시판  -->
	<insert id = "boardInsert">
		insert into board(title, content, user_id)
		value(#{title},#{content},#{user_id})
	</insert>
	<select id = "boardList" resultType="com.team1.health.vo.BoardVO">
		select board_num, title, user_id, hit, date_format(write_date,'%m-%d %H:%i') write_date
		from board 
		<if test='searchWord !=null'>
			where ${searchKey} like '%${searchWord}%'
		</if>
		order by board_num desc
		limit ${onePageRecord} offset ${offsetIndex}
	</select>
	<select id="boardSelect" resultType="com.team1.health.vo.BoardVO">
		select board_num, title, content, user_id, hit, write_date
		from board where board_num=#{param1}
	</select>
	
	<select id = "totalRecord" resultType="int">
		select count(board_num) cnt from board
		<if test='searchWord!=null'>
			where ${searchKey} like '%${searchWord}%'
		</if>
	</select>

</mapper>